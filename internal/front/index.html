<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Link Shortener</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        html {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .shortened-link {
            opacity: 0;
            transform: translateY(10px);
            animation: slideIn 0.3s ease forwards;
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-white">
    <div
        class="absolute inset-0 -z-10 h-full w-full bg-white bg-[linear-gradient(to_right,#f0f0f0_1px,transparent_1px),linear-gradient(to_bottom,#f0f0f0_1px,transparent_1px)] bg-[size:6rem_4rem]">
    </div>
    <div class="min-h-screen flex flex-col items-center justify-center p-4 relative z-10">

        <main class="w-full max-w-2xl">
            <header class="text-center mb-12 mt-12 sm:mt-0">
                <div class="flex items-center justify-center mb-3">
                    <i data-lucide="zap" class="w-10 h-10 text-blue-600 stroke-[2]"></i>
                </div>
                <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 leading-tight">
                    Quick Link Shortener
                </h1>
                <p class="text-lg text-gray-500 mt-4 max-w-md mx-auto">
                    Paste a long link, get a short one. Simple as that.
                </p>
            </header>

            <div class="bg-white rounded-2xl shadow-2xl shadow-blue-500/10 p-8 border border-gray-100">
                <form id="shortenForm" class="flex flex-col sm:flex-row gap-4">
                    <input type="url" name="longUrl" placeholder="Enter your long URL here..."
                        class="flex-1 px-5 py-3 rounded-xl border-2 border-gray-200 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition-all text-base text-gray-700"
                        required>
                    <button type="submit" id="submitButton"
                        class="bg-blue-600 text-white px-7 py-3 rounded-xl hover:bg-blue-700 transition-colors font-bold shadow-lg shadow-blue-500/30 flex items-center justify-center gap-2 transform active:scale-[0.98]">
                        <i data-lucide="send-horizontal" class="w-5 h-5 stroke-[2]"></i>
                        Shorten Link
                    </button>
                </form>
            </div>

            <div id="shortenedLinks" class="w-full mt-6">
            </div>

            <div
                class="flex flex-wrap justify-center gap-6 max-w-xl w-full mx-auto mt-12 text-center text-gray-600 text-base">
                <div class="flex flex-col items-center gap-2 p-3">
                    <i data-lucide="zap" class="w-6 h-6 text-blue-600 stroke-[2]"></i>
                    <span class="font-medium">Lightning Fast</span>
                </div>
                <div class="flex flex-col items-center gap-2 p-3">
                    <i data-lucide="lock" class="w-6 h-6 text-blue-600 stroke-[2]"></i>
                    <span class="font-medium">Secure & Private</span>
                </div>
                <div class="flex flex-col items-center gap-2 p-3">
                    <i data-lucide="edit" class="w-6 h-6 text-blue-600 stroke-[2]"></i>
                    <span class="font-medium">Clean URLs</span>
                </div>
            </div>

        </main>

        <footer class="mt-auto pt-10 pb-8 w-full max-w-2xl relative z-10">
            <div class="text-gray-500 text-sm text-center">
                &copy; 2025 Link Shortener. All rights reserved. |
                <a href="https://github.com/leonibeldev" target="_blank" rel="noopener noreferrer"
                    class="text-blue-600 hover:text-blue-700 transition-colors font-medium">Developer</a>
            </div>
        </footer>
    </div>

    <script>
        lucide.createIcons();

        const shortenedLinksContainer = document.getElementById('shortenedLinks');

        function renderLucideIcon(name, className) {
            return `<i data-lucide="${name}" class="${className} stroke-[2]"></i>`;
        }

        function addShortenedLink(originalUrl, shortUrl) {
            shortenedLinksContainer.innerHTML = '';

            const linkElement = document.createElement('div');
            linkElement.className = 'shortened-link bg-gray-50 border border-blue-200 rounded-xl shadow-lg p-5 sm:p-6 flex flex-col gap-3';

            linkElement.innerHTML = `
                <div class="w-full flex justify-between items-center">
                    <a href="${shortUrl}" target="_blank" class="text-xl sm:text-2xl text-blue-700 font-bold hover:underline truncate max-w-[60%] sm:max-w-[75%]" title="${shortUrl}">
                        ${shortUrl}
                    </a>
                    <div class="flex items-center gap-2">
                        
                        <button onclick="copyToClipboard('${shortUrl}', this)" 
                                class="text-gray-600 hover:text-blue-700 transition-colors p-2 rounded-full bg-white border border-gray-200 hover:bg-blue-50"
                                title="Copy Link">
                            ${renderLucideIcon('copy', 'w-5 h-5')}
                        </button>

                        <a href="${shortUrl}" target="_blank" 
                            class="text-gray-600 hover:text-blue-700 transition-colors p-2 rounded-full bg-white border border-gray-200 hover:bg-blue-50"
                            title="Open Link">
                            ${renderLucideIcon('external-link', 'w-5 h-5')}
                        </a>

                    </div>
                </div>
                <p class="text-sm text-gray-500 truncate w-full border-t border-gray-100 pt-3" title="Original: ${originalUrl}">
                    ${originalUrl}
                </p>
            `;

            shortenedLinksContainer.appendChild(linkElement);
            lucide.createIcons();
        }

        async function copyToClipboard(text, button) {
            try {
                await navigator.clipboard.writeText(text);

                const originalIconHTML = button.innerHTML;

                button.innerHTML = renderLucideIcon('check', 'w-5 h-5 text-green-500');
                button.classList.remove('hover:text-blue-700', 'hover:bg-blue-50');
                button.classList.add('bg-green-100', 'border-green-300');

                lucide.createIcons();

                setTimeout(() => {
                    button.innerHTML = originalIconHTML;
                    button.classList.remove('bg-green-100', 'border-green-300');
                    button.classList.add('hover:text-blue-700', 'hover:bg-blue-50');
                    lucide.createIcons();
                }, 1500);

            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('Could not copy link to clipboard.');
            }
        }

        document.getElementById('shortenForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const input = this.querySelector('input[name="longUrl"]');
            const url = input.value;
            const submitButton = document.getElementById('submitButton');
            const originalButtonContent = submitButton.innerHTML;

            submitButton.disabled = true;
            submitButton.innerHTML = `${renderLucideIcon('loader-circle', 'w-5 h-5 animate-spin')} Shortening...`;
            lucide.createIcons();

            fetch('/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "link": url
                }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.id) {
                        const shortUrl = window.location.origin + "/" + data.id;
                        addShortenedLink(url, shortUrl);
                        input.value = '';
                    } else {
                        console.error('API response missing ID:', data);
                        alert('Link shortened, but response format was unexpected.');
                    }
                })
                .catch(error => {
                    console.error('Error shortening URL:', error);
                    alert('Error: Could not shorten link. Check the console for details.');
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonContent;
                    lucide.createIcons();
                });

        });
    </script>
</body>

</html>